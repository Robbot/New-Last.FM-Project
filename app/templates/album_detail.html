{# templates/album_detail.html #}
{% extends "base_library.html" %}

{% block summary_header %}
<h2>
  <a href="{{ url_for('artists.artist_detail', artist_name=album_artist_name) }}">
    {{ album_artist_name }}</a> â€” {{ album_name }}</h2>
{% endblock %}

{% block main_content %}

<div class="album-detail-container">
  <div class="album-cover">
    {% if cover_url %}
      <img src="{{ cover_url }}" alt="Album art" class="album-cover-img">
    {% else %}
      <div class="album-cover-placeholder">
        no cover
      </div>
    {% endif %}
  </div>

  <div>
    {% if start and end %}
      <p><strong>Plays ({{ start }} to {{ end }}):</strong> {{ total_plays }}</p>
      <p class="text-muted"><small>All-time plays: {{ all_time_total }}</small></p>
    {% else %}
      <p><strong>Total plays (All time):</strong> {{ total_plays }}</p>
    {% endif %}
    <p><strong>Tracks:</strong> {{ tracks|length }}</p>
    <p><strong>Release date:</strong> {{ release_year }}</p>
    {% if wikipedia_url and wikipedia_url != "N/A" %}
      <p><strong>Wikipedia:</strong> <a href="{{ wikipedia_url }}" target="_blank" rel="noopener noreferrer">View article</a></p>
    {% endif %}
  </div>
</div>

<h2>Tracklist</h2>
<div class="mb-4">
  <strong>Sort by:</strong>
  {% set query_params = {'from': from_arg, 'to': to_arg, 'rangetype': rangetype} %}
  {% if sort_by == 'tracklist' %}
    <span class="fw-bold text-dark">Tracklist</span>
    <a href="{{ url_for('albums.artist_album_detail', album_artist_name=album_artist_name, album_name=album_name, sort='plays', **query_params) }}" class="ms-3 sort-link">Popularity</a>
  {% else %}
    <a href="{{ url_for('albums.artist_album_detail', album_artist_name=album_artist_name, album_name=album_name, sort='tracklist', **query_params) }}" class="sort-link">Tracklist</a>
    <span class="ms-3 fw-bold text-dark">Popularity</span>
  {% endif %}
</div>
{% if start and end %}
  <p class="text-muted"><small>Showing plays from {{ start }} to {{ end }}</small></p>
{% endif %}
{% if tracks %}
<table class="table">
  <thead>
    <tr>
      <th>#</th>
      <th>Track</th>
      <th>Plays</th>
    </tr>
  </thead>
  <tbody>
    {% for row in tracks %}
      <tr>
        <td>{{ row["track_number"] }}</td>
        <td><a href="{{ url_for('tracks.track_detail', artist_name=row['track_artist'], track_name=row['track_name']) }}">
          {{ row["track_name"] }}</a>
        </td>
        <td>{{ row["plays"] }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p><em>Tracklist not available for this album. Last.fm may not have information about this release.</em></p>
{% endif %}
{% endblock %}